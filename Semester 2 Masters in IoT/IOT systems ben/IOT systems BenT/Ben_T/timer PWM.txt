/*
 * main.c
 *
 *  Created on: 17 Sep 2015
 *      Author: benjie
 */

#include <avr/io.h>
#include <util/delay.h>
#include <avr/interrupt.h>
#include <avr/sleep.h>
int main(void)
{
	//LED PIN direction
	DDRB |= (1<<5);

	DDRD &= ~(1<<2);		//pull up resistor INT0  PD2pin
	PORTD |= (1<<2);

	EICRA |= (1<<ISC00);		//configure falling edge

	EIMSK |= (1<<INT0);		//enable int0

	sei();		//global enable interrupt- put 1 in I bit SREG tells CPU to allow interrupts without this int won't work.

	while(1)
	{
		sleep_mode();	//CPU stops executing code

		//if here- interrupt occurred
	}
}

ISR(INT0_vect)
{
	DDRB ^= (1<<5);	//toggle led
	_delay_ms(20);

	if (EIFR & (1<<INTF0))
	{
		//clear bounce manually flag
		EIFR |= (1<<INTF0);
	}
}



//if (EICRA & (1<<ISC00))	//rising edge triggered.	13/11/2018


ISR(INT0_vect)
{
	
	_delay_ms(20);		//not good for ISRs avoid delays

	if (EIFR & (1<<INTF0))
	{
		//clear bounce manually flag
	EIFR |= (1<<INTF0);		//write 1 to flag
	}

if( !(PIND & (1<<2))) // pd2 is low
{
PORTB ^= (1<<5);			//toggle led of arduino
}
}



